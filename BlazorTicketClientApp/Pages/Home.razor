@page "/"
@using BlazorTicketClientApp.Components
@using BlazorTicketClientApp.Models
@using BlazorTicketClientApp.Services
@using Shared.Models
@inject ITicketsService ticketsService
<PageTitle>Home</PageTitle>

<div id="main-body">
	<h1 class="ticket-header">All tickets</h1>
	<section class="all-tickets">
		@if(tickets != null)
		{
			@foreach (TicketViewModel ticket in tickets)
			{
				<Ticket TicketModel="ticket" OnDelete="HandleDelete" AbleToDelete="true"/>
			}
		}
		
	</section>
	<button @onclick="CreateTicket" class="create-ticket-btn">Create a new ticket</button>
	@if(isCreatingTicket)
	{
		<div class="form-box">
			<TicketForm OnTicketSubmitted="HandleTicketSubmitted"/>
		</div>
	}
</div>




@code {
	private bool isCreatingTicket;
	private List<TicketViewModel> tickets;
	private Tag selectedTag;
	public TicketViewModel Ticket { get; set; } = new();

	protected override async Task OnInitializedAsync()
	{
		isCreatingTicket = false;
		await UpdateTickets();
	}

	private void CreateTicket()
	{
		isCreatingTicket = !isCreatingTicket;
	}

	private async Task HandleTicketSubmitted()
	{
		await UpdateTickets();
	}

	private async Task HandleDelete()
	{
		await UpdateTickets();
	}

	private async Task UpdateTickets()
	{
		tickets = await ticketsService.GetAllAsync();
	}
}
    


